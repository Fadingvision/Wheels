<!DOCTYPE html>
<html lang="en" ng-app='exampleDialog'>
<head>
    <meta charset="UTF-8">
    <title>ngDialog</title>
    <link rel="stylesheet" href="index.css">
</head>
<body ng-controller="MainCtrl">
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    2 <br>
    <button ng-click="open()">open</button>

    <script type="text/ng-template" id="secondDialog">
        <div class="ngdialog-message">
            <h2>And even more!</h2>
            <ul class="mt">
                <li>Load your templates as strings, ng-template tags or html partials</li>
                <li>ngDialog.js is < 2kb when minified!</li>
                <li>It has simple, extendable and elegant API ;)</li>
            </ul>
            <div class="mt">Spread a word about it:</div>
        </div>
        <div class="mt">
            <a href="http://twitter.com/home?status=ngDialog.js - modal windows and popups provider for Angular.js applications, via @likeastore!+http://likeastore.github.io/ngDialog/" class="action-btn" ng-like>Tweet</a>
            <a href="http://www.facebook.com/share.php?u=http://likeastore.github.io/ngDialog" class="action-btn" ng-like>Like</a>
            <a href="https://github.com/likeastore/ngDialog#ngdialog" class="action-btn read" target="_blank">Read docs</a>
        </div>
    </script>
    <script src="angular.min.js"></script>
    <script src="ngDialog.min.js"></script>
    <script>
        var app = angular.module('exampleDialog', ['ngDialog']);
        app.controller('MainCtrl', function ($scope, ngDialog, $rootScope, $q) {
            var currentDialog;
            $rootScope.$on('ngDialog.opened', function (e, $dialog) {
                // var currentDialog = $dialog.attr('id');
                // if(currentDialog) ngDialog.close(currentDialog);
                console.log('ngDialog opened: ' + $dialog.attr('id'));
                console.log(JSON.parse(JSON.stringify(ngDialog.getOpenDialogs())))
                ngDialog.getOpenDialogs().forEach((item, index) => {
                    if(index !== 0) ngDialog.close(item);
                });
            });


            // $rootScope.$emit('sss', 123);

            // $rootScope.$on('sss', function (e, data) {
            //     console.log(data);
            // });

            // $scope.$emit('sss', 123);

            function showDialog() {
                var deferred = $q.defer();
                var dialog = ngDialog.open({
                    template: 'secondDialog',
                    controller: 'FirstDialogCtrl',
                    className: 'ngdialog-theme-default ngdialog-theme-custom',
                    disableAnimation: true,
                });
                $rootScope.$on('ngDialog.opened', function (e, $dialog) {
                    deferred.resolve($dialog.attr('id'));
                });
                return deferred.promise;
            }


            // 方法1：＝>通过事件回调 (问题： rootScope不能接受自己派发的事件)
            // 方法2：=> 通过promise进行

            $scope.open = function () {
                [1,2,3,4,5].forEach( () => {
                    // if(currentDialog && ngDialog.isOpen(currentDialog.id)) return;
                    // if(currentDialog){
                    //     console.log(currentDialog.id)
                    //     console.log(ngDialog.isOpen(currentDialog.id))
                    // }
                    var dialog = ngDialog.open({
                        template: 'secondDialog',
                        controller: 'FirstDialogCtrl',
                        className: 'ngdialog-theme-default ngdialog-theme-custom',
                        disableAnimation: true,
                    });
                    // ((dialog) => {
                    //     setTimeout(function () {
                    //         var isOpen = ngDialog.isOpen(dialog.id);
                    //         console.log(isOpen);
                    //     }, 100)
                    // })(dialog);

                });
                // currentDialog.closePromise.then(function() {
                //     console.log(ngDialog.isOpen(currentDialog))
                // })
                // setTimeout(function() {
                //     $scope.$apply()
                //     console.log(ngDialog.isOpen(currentDialog.id))
                // }, 1000)
            };
        });

        app.controller('FirstDialogCtrl', function ($scope, ngDialog) {
            $scope.next = function () {
                ngDialog.close('ngdialog1');
                ngDialog.open({
                    template: 'secondDialog',
                    className: 'ngdialog-theme-flat ngdialog-theme-custom'
                });
            };
        });
    </script>



</body>
</html>